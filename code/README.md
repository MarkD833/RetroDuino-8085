# RetroDuino-8085 Software

## The 8085 Monitor 
The MON85 folder contains a modified version of the excellent 8085 monitor called MON85 written by [Dave Dunfield](https://dunfield.themindfactory.com/). You can find the source code to the 8085 monitor along with monitors for other micros in the MONITORS.ZIP file on Dave's website. The monitor code needs tweeking to support the specific UART hardware I am using but that simply involves providing code to initialise the UART and code to output a characher/byte as well as read in a character/byte.

MON85 can be assembled using the free online assembler at [ASM80.COM](https://asm80.com) - select the 8080 CPU.

The MON85 user manual is also in the MON85 folder.

I've modified MON85 to work with the SCC2691 UART such that there are 2 versions of MON85 available:

| Software | Notes |
| :---- | :---- |
| MON85_ROM | Monitor runs in ROM and 48K RAM is available from 0x4000 - 0xFFFF. |
| MON85_RAM | Monitor runs in RAM and the whole 64K RAM is available but the monitor resides at 0x0000 - 0x1100. |

In addition, the MON85_ROM version has a small tweak. During initialisation, a small piece of code is copied from the ROM into RAM starting at address 0xFF80. Executing the code from MON85 with a "g FF80" command will disable the ROM (and MON85) and execute code starting at address 0x0000.
  
## A simple LED flasher
The LEDTest folder contains a simple piece of assembler code that flashes the 2 onboard LEDs. The code was assembled using the [ASM80](https://www.asm80.com/) online assembler. Set the CPU type to 8080 when creating the file. I've also put the listing file generated by ASM80 into the LEDTest folder along with the Intel-HEX file that can be loaded using MON85. The code is designed to load at address 0x5000 and run from that address.

## A simple LED flasher in RAM
The LEDTest2 folder contains the same simple LED flashing code as above, BUT demonstates an interesting feature. Note that this code should only be used with the MON85 ROM monitor - it won't work with the MON85 RAM monitor.

The MON85 monitor resides in ROM starting at address 0x0000. The downside of this is usually that you cannot put your own interrupt handlers there as it's Read Only. However, with the RetroDuino-8085 design, you can!

Using the MON85 L command, load the LEDTest2 Intel-HEX file. This will load the LED flashing code into RAM at address 0x0000. Even though the MON85 ROM resides in this area, MON85 can actually write to the RAM at the same address - it just can't read from that RAM. Any attempt to read from this area will read the ROM - i.e MON85.

In order to run the code, give MON85 the command "g FF80". There is a small piece of code that is pre-loaded by MON85 that resides at this address. This simple bit of code sets the 8085 SOD pin high - switching out the MON85 ROM completely - and then jumps to address 0x0000 to execute whatever code it finds there.

You can put whatever code you like into low memory and run it just like it would run from ROM.

The downside is that once the ROM is switched out, you loose all the MON85 capabilities like inspecting and modifying memory, setting breakpoints etc.

# z88dk - The z80 development kit

## A Simple Hello
I've figured out how to use the [z88dk](https://z88dk.org/site/) suite to create some code for the RetroDuino-8085. I'm completely new to the z88dk tools so look away now if you've already got experience of using z88dk as what follows might not be pretty! Expect dragons!

The traditional ["Hello World"](https://en.wikipedia.org/wiki/%22Hello,_World!%22_program) code was created by following the [Classic Homebrew](https://github.com/z88dk/z88dk/wiki/Classic--Homebrew) hardware quick start guide and includes console input. As the RetroDuino-8085 can run code from address 0x0000, I've also got a basic crt0 file as well. It's all in the simple_hello folder along with the batch file I used to build the code.

Use the MON85 L command to load the Intel-HEX file and then give MON85 the command "g FF80" to switch out the ROM and run the code.
